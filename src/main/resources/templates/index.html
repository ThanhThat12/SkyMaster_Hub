<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Schedules - AirLabs(Da co webhook, final)</title>
    
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1> Flight Schedules Tracker(Webhook test 2)</h1>
            <p>Search and track flight schedules with smart caching</p>
            <div style="margin-top: 15px;">
                <a href="/delays" style="margin-right: 10px; padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 5px;">üïê Delayed Flights</a>
                <a href="/realtime-flights" style="padding: 10px 20px; background: #2ecc71; color: white; text-decoration: none; border-radius: 5px;">‚úàÔ∏è Real-time Flights</a>
            </div>
        </div>

        <div class="content">
          
            <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

          
            <div class="forms-section">
                <!-- Fetch New Schedules Form -->
                <div class="form-card">
                    <h2> Fetch New Schedules</h2>
                    <form action="/fetch" method="post">
                        <div class="form-group">
                            <label for="arrIata">Arrival Airport (IATA Code)</label>
                            <input type="text" 
                                   id="arrIata" 
                                   name="arrIata" 
                                   placeholder="e.g., JFK, LAX, NRT"
                                   maxlength="3"
                                   required>
                            <small style="color: #6c757d; display: block; margin-top: 5px;">
                                Enter 3-letter IATA code to fetch flights arriving at this airport
                            </small>
                        </div>
                        <button type="submit" class="btn btn-primary">
                             Fetch from API
                        </button>
                    </form>
                </div>

                <!-- Search Existing Schedules Form -->
                <div class="form-card">
                    <h2> Search Existing Schedules</h2>
                    <form action="/search" method="get">
                        <div class="form-group">
                            <label for="searchType">Search By</label>
                            <select id="searchType" onchange="updateSearchField()">
                                <option value="arrIata">Arrival Airport</option>
                                <option value="airline">Airline</option>
                                <option value="depIata">Departure Airport</option>
                            </select>
                        </div>

                        <div class="form-group" id="arrIataGroup">
                            <label for="searchArrIata">Arrival Airport IATA</label>
                            <input type="text" 
                                   id="searchArrIata" 
                                   name="arrIata" 
                                   placeholder="e.g., JFK"
                                   th:value="${searchArrIata}"
                                   maxlength="3">
                        </div>

                        <div class="form-group" id="airlineGroup" style="display: none;">
                            <label for="searchAirline">Airline IATA</label>
                            <input type="text" 
                                   id="searchAirline" 
                                   name="airline" 
                                   placeholder="e.g., AA, DL"
                                   th:value="${searchAirline}"
                                   maxlength="3">
                        </div>

                        <div class="form-group" id="depIataGroup" style="display: none;">
                            <label for="searchDepIata">Departure Airport IATA</label>
                            <input type="text" 
                                   id="searchDepIata" 
                                   name="depIata" 
                                   placeholder="e.g., LAX"
                                   th:value="${searchDepIata}"
                                   maxlength="3">
                        </div>

                        <button type="submit" class="btn btn-secondary">
                            üîç Search Database
                        </button>
                    </form>
                </div>
            </div>

            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="number" th:text="${totalSchedules}">0</div>
                    <div class="label">Total Schedules</div>
                </div>
                <div class="stat-item">
                    <div class="number" th:text="${schedules != null ? schedules.size() : 0}">0</div>
                    <div class="label">Displayed</div>
                </div>
            </div>

            <!-- Table -->
            <div class="table-container">
                <table th:if="${schedules != null and !schedules.empty}">
                    <thead>
                        <tr>
                            <th>Flight</th>
                            <th>Airline</th>
                            <th>Departure</th>
                            <th>Arrival</th>
                            
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="schedule : ${schedules}">
                            <td>
                                <span class="badge badge-flight" th:text="${schedule.flightIata}">-</span>
                            </td>
                            <td>
                                <span class="badge badge-airline" th:text="${schedule.airlineIata}">-</span>
                                <br>
                                <small th:text="${schedule.airlineName}">-</small>
                            </td>
                            <td>
                                <strong th:text="${schedule.depIata}">-</strong>
                                <br>
                                <small th:text="${schedule.depAirportName}">-</small>
                            </td>
                            <td>
                                <strong th:text="${schedule.arrIata}">-</strong>
                                <br>
                                <small th:text="${schedule.arrAirportName}">-</small>
                            </td>
                            
                        </tr>
                    </tbody>
                </table>

                <div th:if="${schedules == null or schedules.empty}" class="no-data">
                    <div class="icon">üì≠</div>
                    <h3>No schedules found</h3>
                    
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateSearchField() {
            const searchType = document.getElementById('searchType').value;
            
            // Hide all
            document.getElementById('arrIataGroup').style.display = 'none';
            document.getElementById('airlineGroup').style.display = 'none';
            document.getElementById('depIataGroup').style.display = 'none';
            
            // Clear all inputs
            document.getElementById('searchArrIata').value = '';
            document.getElementById('searchAirline').value = '';
            document.getElementById('searchDepIata').value = '';
            
            // Show selected
            if (searchType === 'arrIata') {
                document.getElementById('arrIataGroup').style.display = 'block';
            } else if (searchType === 'airline') {
                document.getElementById('airlineGroup').style.display = 'block';
            } else if (searchType === 'depIata') {
                document.getElementById('depIataGroup').style.display = 'block';
            }
        }

        // Auto uppercase IATA codes
        document.querySelectorAll('input[type="text"]').forEach(input => {
            input.addEventListener('input', function() {
                this.value = this.value.toUpperCase();
            });
        });
    </script>
</body>
</html>



<style>
table {
    width: 100%;
    border-collapse: collapse;
    background: white;
}

th, td {
    border: 1px solid #ddd;   
    padding: 10px;
    text-align: left;
}

th {
    background-color: #f4f6f8;
    font-weight: bold;
}

tr:nth-child(even) {
    background-color: #fafafa;
}

tr:hover {
    background-color: #f1f1f1;
}
</style>

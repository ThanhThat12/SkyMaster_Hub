<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Delays Tracker</title>
   
</head>
<body>
    <div class="container">
        <h1> Flight Delays Tracker</h1>

        <!-- Success/Error Messages -->
        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

      
        <div class="section" th:if="${cacheInfo}">
            <h2> Cache Status </h2>
            
            <!-- Cache Statistics -->
            <div class="cache-stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Cache Size</div>
                    <div class="stat-value" th:text="${cacheInfo.size} + ' / ' + ${cacheInfo.capacity}">0 / 3</div>
                </div>
                <!-- <div class="stat-box">
                    <div class="stat-label">Hit Rate</div>
                    <div class="stat-value" th:text="${cacheInfo.hitRate}">0%</div>
                </div> -->
                <div class="stat-box">
                    <div class="stat-label">Total Hits</div>
                    <div class="stat-value" th:text="${cacheInfo.hitCount}">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Misses</div>
                    <div class="stat-value" th:text="${cacheInfo.missCount}">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Evictions</div>
                    <div class="stat-value" th:text="${cacheInfo.evictionCount}">0</div>
                </div>
            </div>

         
            <div>
                <strong>Capacity Utilization:</strong>
                <div class="progress-bar">
                    <div class="progress-fill" th:style="'width: ' + ${cacheInfo.utilizationPercent} + '%'"></div>
                </div>
                <p style="text-align: right; margin-top: 5px; font-size: 12px; color: #718096;">
                    <span th:text="${#numbers.formatDecimal(cacheInfo.utilizationPercent, 1, 2)}">0</span>% used
                </p>
            </div>

           

            <!-- Cache Entries List -->
            <div style="margin-top: 25px;">
                <h3 style="color: #2d3748; margin-bottom: 15px; font-size: 18px;">
                     Cached Entries (<span th:text="${#lists.size(cacheInfo.entries)}">0</span>)
                </h3>
                
                <div class="empty-cache" th:if="${#lists.isEmpty(cacheInfo.entries)}">
                    <div style="font-size: 48px;"></div>
                    <p>Cache trống. Hãy fetch data để thấy cache hoạt động!</p>
                </div>

                <div class="cache-entries-list" th:if="${not #lists.isEmpty(cacheInfo.entries)}">
                    <div class="cache-entry" th:each="entry : ${cacheInfo.entries}">
                        <div>
                            <div class="cache-key" th:text="${entry.key}">cache-key</div>
                        </div>
                        <div class="cache-meta">
                            <span>
                                 <strong th:text="${entry.flightCount}">0</strong> flights
                            </span>
                        </span>
                         <strong th:text="${entry.hitCount}">0</strong> times
                    </span>
                            <span>
                                 <strong th:text="${#numbers.formatDecimal(entry.sizeKB, 1, 1)}">0</strong> KB
                            </span>
                        </div>
                    </div>
                </div>

                
            </div>
        </div>

        <!-- Fetch New Delays Form -->
        <div class="section">
            <h2> Fetch Delayed Flights from API</h2>
            <form action="/delays/fetch" method="post">
                <div class="form-row">
                    <div class="form-group">
                        <label for="type">Type:</label>
                        <select id="type" name="type" required>
                            <option value="arrivals">Arrivals</option>
                            <option value="departures">Departures</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="iataCode">Airport Code (IATA):</label>
                        <input type="text" id="iataCode" name="iataCode" 
                               placeholder="JFK, LAX, SGN" 
                               maxlength="3" required>
                    </div>
                    <div class="form-group">
                        <label for="minDelay">Min Delay (minutes):</label>
                        <input type="number" id="minDelay" name="minDelay" 
                               value="30" min="0" max="500" required>
                    </div>
                </div>
                <button type="submit"> Fetch from API</button>
            </form>
        </div>

        <!-- Search Delays Form -->
        <div class="section">
            <h2> Search Delayed Flights</h2>
            <form action="/delays/search" method="get">
                <div class="form-row">
                    <div class="form-group">
                        <label for="searchIataCode">Arrival Airport:</label>
                        <input type="text" id="searchIataCode" name="iataCode" 
                               placeholder="JFK" maxlength="3">
                    </div>
                    <div class="form-group">
                        <label for="searchAirline">Airline Code:</label>
                        <input type="text" id="searchAirline" name="airline" 
                               placeholder="AA, DL, UA" maxlength="3">
                    </div>
                    <div class="form-group">
                        <label for="searchDepIata">Departure Airport:</label>
                        <input type="text" id="searchDepIata" name="depIata" 
                               placeholder="LAX" maxlength="3">
                    </div>
                </div>
                <button type="submit"> Search</button>
            </form>
        </div>

        <!-- Delays Table -->
        <div class="section">
            <h2> Delayed Flights (<span th:text="${#lists.size(delays)}">0</span>)</h2>
            
            <div class="empty-state" th:if="${#lists.isEmpty(delays)}">
                <div class="empty-state-icon"></div>
                <h3>No Delayed Flights</h3>
                <p th:if="${searchPerformed}">No results found for your search criteria.</p>
                <p th:unless="${searchPerformed}">Click "Fetch from API" to load flight delay data.</p>
            </div>

            <table th:if="${not #lists.isEmpty(delays)}">
                <thead>
                    <tr>
                        <th>Flight</th>
                        <th>Airline</th>
                        <th>Departure</th>
                        <th>Dep Time</th>
                        <th>Arrival</th>
                        <th>Arr Time</th>
                        <th>Delay (min)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="delay : ${delays}">
                        <td th:text="${delay.flightIata}">-</td>
                        <td th:text="${delay.airlineIata}">-</td>
                        <td th:text="${delay.depIata}">-</td>
                        <td th:text="${delay.depTime}">-</td>
                        <td th:text="${delay.arrIata}">-</td>
                        <td th:text="${delay.arrTime}">-</td>
                        <td>
                            <strong style="color: #e53e3e;" th:text="${delay.delayMinutes}">0</strong>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
